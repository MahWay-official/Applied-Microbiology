<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Applied Microbiology Exam (70 MCQs)</title>
<style>
  :root{
    --bg:#0b1020;
    --card:#131a2b;
    --ink:#e8ecf1;
    --muted:#a9b1c1;
    --accent:#6aa9ff;
    --good:#36c275;
    --bad:#ff6b6b;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    background: linear-gradient(120deg,#0b1020,#09173a);
    color:var(--ink);
  }
  header{
    position:sticky; top:0; z-index:10;
    backdrop-filter:blur(10px);
    background:rgba(10,15,35,.7);
    border-bottom:1px solid #1f2a44;
  }
  .wrap{max-width:1000px; margin:0 auto; padding:20px;}
  h1{margin:8px 0 4px; font-size: clamp(22px,3vw,30px)}
  p.lead{margin:0 0 12px; color:var(--muted)}
  .controls{display:flex; gap:10px; flex-wrap:wrap; margin:8px 0 12px}
  button,.btn{
    background:var(--accent); color:#06122b; border:none; padding:10px 14px; border-radius:10px;
    font-weight:700; cursor:pointer; transition:transform .05s ease, box-shadow .2s ease;
    box-shadow:0 6px 18px rgba(106,169,255,.25);
  }
  button:hover{transform:translateY(-1px)}
  button.secondary{background:#223150; color:var(--ink)}
  button.ghost{background:transparent; border:1px solid #324362; color:var(--ink)}
  .card{
    background:var(--card); border:1px solid #1f2a44; border-radius:14px; padding:16px; margin:14px 0;
    box-shadow: 0 8px 24px rgba(0,0,0,.25);
  }
  .q-head{display:flex; align-items:baseline; justify-content:space-between; gap:10px}
  .qid{font-weight:800; color:#89a7ff}
  .qtext{font-size:18px; font-weight:600}
  .opts{display:grid; grid-template-columns:1fr; gap:8px; margin-top:10px}
  .opt{
    display:flex; gap:10px; align-items:center; background:#0e1426; border:1px solid #213055; padding:10px; border-radius:10px; cursor:pointer;
  }
  .opt input{accent-color:var(--accent)}
  .exp{
    margin-top:10px; padding:10px; border-radius:10px; display:none;
    background:#0e1a2e; border:1px dashed #2a3c64; color:var(--muted)
  }
  .exp.show{display:block}
  .correct{border-color:#275a44; background:rgba(54,194,117,.08)}
  .wrong{border-color:#6b2a2a; background:rgba(255,107,107,.08)}
  .badge{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700}
  .badge.good{background:rgba(54,194,117,.15); color:#78e2a8; border:1px solid #2b6b4f}
  .badge.bad{background:rgba(255,107,107,.15); color:#ff9f9f; border:1px solid #6b2a2a}
  footer{color:var(--muted); text-align:center; padding:30px 10px}
  .sticky-score{position:fixed; right:16px; bottom:16px; background:#101a33; border:1px solid #27375f; padding:12px 14px; border-radius:12px}
  .small{font-size:12px; color:var(--muted)}
  .ref{margin-top:8px; font-size:12px; color:#8aa2c7}
  .search{flex:1; min-width:220px; background:#0e172c; color:var(--ink); border:1px solid #253555; padding:10px 12px; border-radius:10px}
  .hidden{display:none}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Applied Microbiology – Full Exam (70 MCQs)</h1>
    <p class="lead">Answer all questions, then click <b>Submit & Grade</b>. Explanations are in Arabic, with lecture source note.</p>
    <div class="controls">
      <input id="search" class="search" placeholder="Filter questions (e.g., Staphylococcus, Neisseria, vaccine)"/>
      <button id="submitBtn">Submit & Grade</button>
      <button id="showAnswersBtn" class="secondary">Reveal Correct Answers</button>
      <button id="resetBtn" class="ghost">Reset</button>
      <button id="exportBtn" class="ghost">Export Results (JSON)</button>
    </div>
  </div>
</header>

<main class="wrap" id="container"></main>

<div class="sticky-score" id="scoreBox">
  <div><b>Score:</b> <span id="score">0 / 70</span></div>
  <div class="small" id="note">Not submitted</div>
</div>

<footer>
  © 2025 Applied Microbiology Practice | Built for study use (Delta Univ. slides).<br/>
  Explanations cite: Intro to Microbiology; Host–Parasite Interaction; Staphylococci; Streptococci; Neisseria.
</footer>

<script>
const QUESTIONS = [
  // ===== Part A – From user's own questions (1–19) =====
  {q:"S.aureus colonies on blood agar are:", opts:["delta hemolytic","gamma hemolytic","alpha hemolytic","none of these"], ans:3, exp:"S. aureus يُحدث β-hemolysis (منطقة شفافة حول المستعمرات)، ولأن الاختيارات لا تشمل β → إذن الإجابة الصحيحة \"none of these\". المصدر: Lecture 3 – Staphylococci (blood agar features).", ref:"Staphylococci lecture"},
  {q:"S.aureus on MacConkey’s agar containing inhibitory substance for gram-positive cocci:", opts:["golden yellow colonies","yellow colonies","none of these","pink colonies"], ans:2, exp:"MacConkey يحتوي أملاح صفراء وصفراء الصفراء التي تُثبط Gram-positive؛ لذلك لا يعطي مستعمرات مميزة لـ S. aureus. المصدر: Lecture 3 – Staphylococci (media).", ref:"Staphylococci lecture"},
  {q:"The coagulase test is used to differentiate S. aureus from:", opts:["streptococci","E. coli","pneumococci","other staphylococci"], ans:3, exp:"اختبار الكوناجيوليز يُميّز S. aureus (إيجابي) عن باقي الستاڤيلو كوكس (سالبة). المصدر: Lecture 3 – Staphylococci.", ref:"Staphylococci lecture"},
  {q:"Differentiate between S. epidermidis and S. saprophyticus:", opts:["bacitracin sensitivity","novobiocin sensitivity","coagulase test","penicillin sensitivity"], ans:1, exp:"S. epidermidis حساس للـ Novobiocin بينما S. saprophyticus مقاوم. المصدر: Lecture 3 – Staphylococci.", ref:"Staphylococci lecture"},
  {q:"S. aureus colonies on nutrient agar are:", opts:["white with no pigment","white with pigment","golden yellow-white","whitish grey"], ans:2, exp:"S. aureus غالبًا يكون له صبغة ذهبية (golden yellow) على nutrient agar. المصدر: Lecture 3 – Staphylococci.", ref:"Staphylococci lecture"},
  {q:"The coagulase test is used to differentiate:", opts:["S. epidermidis from Neisseria meningitidis","S. aureus from S. epidermidis","S. pyogenes from Enterococcus faecalis","S. pyogenes from S. aureus"], ans:1, exp:"S. aureus (coagulase-positive) مقابل S. epidermidis (coagulase-negative). المصدر: Lecture 3 – Staphylococci.", ref:"Staphylococci lecture"},
  {q:"Staphylococcus bacteria secrete all, EXCEPT:", opts:["cellulose","coagulase","lecithinase","lipase"], ans:0, exp:"الستاڤيلوكوكس تُنتج إنزيمات كثيرة، لكن لا تُنتج cellulose. المصدر: Lecture 3 – Staphylococci (enzymes).", ref:"Staphylococci lecture"},
  {q:"Infection means", opts:["The establishment of a microorganism within a host","Any microorganism that has the capacity to cause disease","Opportunistic pathogens require a defect in immune defense","Quantitative measure of pathogenicity"], ans:0, exp:"التعريف في المحاضرات: العدوى هي استقرار/تواجد الميكروب داخل العائل. المصدر: Lecture 1 – Introduction / Lecture 2 – Host–Parasite.", ref:"Intro / Host–Parasite"},
  {q:"Clostridium bacillus is:", opts:["Obligate aerobe","Facultative aerobe","Facultative anaerobe","Strict anaerobe"], ans:3, exp:"الكلوستريديوم لا تنمو في وجود الأكسجين (strict anaerobes). مذكور ضمن التعاريف العامة. المصدر: Lecture 1 – Introduction.", ref:"Introduction lecture"},
  {q:"Capsular Swelling Test (Quellung reaction) is used for:", opts:["Enterococcus faecalis","S. agalactiae","S. viridans","S. pneumoniae"], ans:3, exp:"اختبار الانتفاخ الكبسولي (Quellung) لتشخيص S. pneumoniae. المصدر: Lecture 4 – Streptococci.", ref:"Streptococci lecture"},
  {q:"α-hemolytic streptococci are also known as:", opts:["S. viridans","Enterobacter","S. pyogenes","Coagulase negative staph"], ans:0, exp:"المجموعة المعروفة بالـ viridans هي α-hemolytic. المصدر: Lecture 4 – Streptococci.", ref:"Streptococci lecture"},
  {q:"Gram-negative cocci are:", opts:["streptococci","staphylococci","Neisseria","Salmonella"], ans:2, exp:"النييسرية هي مكورات سالبة الجرام (diplococci). المصدر: Lecture 5 – Neisseria.", ref:"Neisseria lecture"},
  {q:"The following species of staphylococci are coagulase positive:", opts:["S. epidermidis","S. saprophyticus","S. hominis","S. aureus"], ans:3, exp:"S. aureus هو الأنواع الرئيسية الإيجابية للكوناجيوليز. المصدر: Lecture 3 – Staphylococci.", ref:"Staphylococci lecture"},
  {q:"S. aureus differs from S. epidermidis by:", opts:["Forms white colonies","Is coagulase positive","Causes endocarditis on the prosthetic valve","Common cause of UTI"], ans:1, exp:"الفرق الرئيسي الإكلينيكي/المعملي: S. aureus موجب الكوناجيوليز، بينما S. epidermidis سالب. المصدر: Lecture 3 – Staphylococci.", ref:"Staphylococci lecture"},
  {q:"Novobiocin sensitivity test is used to differentiate between:", opts:["S.epidermidis and S.saprophyticus","S.aureus and S.saprophyticus","S.epidermidis and S.hominis","S.aureus and S.epidermidis"], ans:0, exp:"S. epidermidis حساس، S. saprophyticus مقاوم. المصدر: Lecture 3 – Staphylococci.", ref:"Staphylococci lecture"},
  {q:"Neisseria gonorrhoeae is", opts:["all of these","glucose fermentation but not maltose","oxidase positive","catalase positive"], ans:0, exp:"N. gonorrhoeae مؤكسدة موجبة، كاتالاز موجبة، وتخمر الجلوكوز فقط. المصدر: Lecture 5 – Neisseria.", ref:"Neisseria lecture"},
  {q:"Normal flora is present in all of these sites except", opts:["throat","stool","urine","mouth"], ans:2, exp:"البول الطبيعي معقم. المصدر: Lecture 1 – Introduction.", ref:"Introduction lecture"},
  {q:"Selective media for staph aureus is:", opts:["Blood agar","MSA agar","MacConkey’s agar","Nutrient agar"], ans:1, exp:"Mannitol Salt Agar (ملح عالي + مانيتول) انتقائي للستاف. المصدر: Lecture 3 – Staphylococci.", ref:"Staphylococci lecture"},
  {q:"Opportunistic pathogens", opts:["Opportunistic pathogens requiring a defect in the immune defense","Any microorganism that has the capacity to cause disease","The establishment of a microorganism within a host","Quantitative measure of pathogenicity"], ans:0, exp:"تعريف الـ opportunists: تُسبب مرضًا عند وجود عيب مناعي. المصدر: Lecture 2 – Host–Parasite.", ref:"Host–Parasite lecture"},

  // ===== Part B – 50-question bank (20–70 overall, indexed here sequentially) =====
  {q:"Microorganisms that cause disease are called:", opts:["Commensals","Pathogens","Normal flora","Saprophytes"], ans:1, exp:"Pathogens = مُمرِضات. المصدر: Lecture 1 – Introduction.", ref:"Introduction lecture"},
  {q:"The study of microorganisms is called:", opts:["Biology","Microbiology","Pathology","Immunology"], ans:1, exp:"تعريف عام. المصدر: Lecture 1 – Introduction.", ref:"Introduction lecture"},
  {q:"Virulence is defined as:", opts:["Ability of a pathogen to invade a host","Quantitative measure of pathogenicity","Defect in host immunity","Commensal behavior"], ans:1, exp:"الفوعة = قياس كمي للإمراضية. المصدر: Lecture 1 – Introduction.", ref:"Introduction lecture"},
  {q:"Infection means:", opts:["Presence of toxins in host","Establishment of microorganism within a host","Defect in immune defense","Normal flora existence"], ans:1, exp:"التعريف بالنص. المصدر: Lecture 1 / Lecture 2.", ref:"Intro / Host–Parasite"},
  {q:"Opportunistic pathogens require:", opts:["Normal flora","Defect in immune defense","Anaerobic condition","Virulence factors"], ans:1, exp:"تحتاج لخلل مناعي. المصدر: Lecture 2 – Host–Parasite.", ref:"Host–Parasite lecture"},
  {q:"The host that harbors a pathogen without symptoms is:", opts:["Reservoir","Carrier","Vector","Host"], ans:1, exp:"الحامل Carrier لا يظهر عليه أعراض. المصدر: Lecture 2 – Host–Parasite.", ref:"Host–Parasite lecture"},
  {q:"Mutualism means:", opts:["One benefits, other harmed","Both benefit","One benefits, other unaffected","None"], ans:1, exp:"تكافل نَفعي للطرفين. المصدر: Lecture 2 – Host–Parasite.", ref:"Host–Parasite lecture"},
  {q:"Disease in high numbers at same time:", opts:["Endemic","Epidemic","Pandemic","Sporadic"], ans:1, exp:"وباء = زيادة مفاجئة في الحالات. المصدر: Lecture 2 – Host–Parasite.", ref:"Host–Parasite lecture"},
  {q:"Disease worldwide is:", opts:["Pandemic","Endemic","Sporadic","Epidemic"], ans:0, exp:"جائحة = انتشار عالمي. المصدر: Lecture 2 – Host–Parasite.", ref:"Host–Parasite lecture"},
  {q:"Staphylococcus are:", opts:["Gram-positive cocci in clusters","Gram-negative cocci","Gram-positive bacilli","Gram-negative bacilli"], ans:0, exp:"عنقودية موجبة الجرام. المصدر: Lecture 3 – Staphylococci.", ref:"Staphylococci lecture"},
  {q:"Selective medium for S. aureus:", opts:["Nutrient agar","MSA agar","Blood agar","MacConkey agar"], ans:1, exp:"MSA انتقائي. المصدر: Lecture 3.", ref:"Staphylococci lecture"},
  {q:"S. aureus on nutrient agar appears:", opts:["White","Golden yellow","Pink","Grey"], ans:1, exp:"صبغة ذهبية. المصدر: Lecture 3.", ref:"Staphylococci lecture"},
  {q:"Coagulase test differentiates S. aureus from:", opts:["Streptococci","Other staphylococci","Pneumococci","Enterococci"], ans:1, exp:"S. aureus موجب. المصدر: Lecture 3.", ref:"Staphylococci lecture"},
  {q:"S. epidermidis vs S. saprophyticus test is:", opts:["Novobiocin sensitivity","Bacitracin sensitivity","Coagulase","Penicillin"], ans:0, exp:"Novobiocin. المصدر: Lecture 3.", ref:"Staphylococci lecture"},
  {q:"Enzyme not secreted by staphylococci:", opts:["Cellulose","Lipase","Coagulase","Lecithinase"], ans:0, exp:"لا تنتج cellulose. المصدر: Lecture 3.", ref:"Staphylococci lecture"},
  {q:"Hemolysis of S. aureus on blood agar:", opts:["Beta hemolysis","Alpha hemolysis","Gamma hemolysis","None"], ans:0, exp:"β-hemolysis. المصدر: Lecture 3.", ref:"Staphylococci lecture"},
  {q:"Main coagulase positive species:", opts:["S. saprophyticus","S. aureus","S. hominis","S. epidermidis"], ans:1, exp:"S. aureus. المصدر: Lecture 3.", ref:"Staphylococci lecture"},
  {q:"Staphylococcal food poisoning caused by:", opts:["Enterotoxin","Exfoliative toxin","Endotoxin","Coagulase"], ans:0, exp:"السم المعوي. المصدر: Lecture 3.", ref:"Staphylococci lecture"},
  {q:"S. aureus catalase:", opts:["Negative","Positive","Variable","None"], ans:1, exp:"ستاف = catalase +. المصدر: Lecture 3.", ref:"Staphylococci lecture"},
  {q:"Streptococci are:", opts:["Gram-negative cocci","Gram-positive cocci in chains","Gram-positive rods","Gram-negative rods"], ans:1, exp:"سلاسل موجبة الجرام. المصدر: Lecture 4 – Streptococci.", ref:"Streptococci lecture"},
  {q:"S. pyogenes is:", opts:["Group A beta-hemolytic","Group B alpha-hemolytic","Group D non-hemolytic","Gamma-hemolytic"], ans:0, exp:"GAS β-hemolytic. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"Bacitracin sensitivity test is for:", opts:["S. pneumoniae","S. pyogenes","S. agalactiae","Enterococcus"], ans:1, exp:"مميز لـ Group A. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"CAMP test identifies:", opts:["Group A strep","Group B strep","Group C strep","Group D strep"], ans:1, exp:"GBS إيجابي CAMP. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"ASO test detects:", opts:["Antibodies against Streptolysin O","Antibodies against M protein","Exotoxin A","Capsule antigen"], ans:0, exp:"قياس أضداد SLO. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"Rheumatic fever follows:", opts:["Pharyngitis due to S. pyogenes","Skin infections","Meningitis","UTI"], ans:0, exp:"بعد التهاب حلق بستربتوكوكاي. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"Acute glomerulonephritis follows:", opts:["S. pneumoniae","Skin infections with S. pyogenes","S. agalactiae","Enterococcus"], ans:1, exp:"بعد عدوى جلدية بستربتوكوكاي. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"Quellung reaction identifies:", opts:["S. pyogenes","S. pneumoniae","S. agalactiae","Viridans streptococci"], ans:1, exp:"انتفاخ كبسولي للـ Pneumococcus. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"Viridans streptococci cause:", opts:["Acute endocarditis","Subacute endocarditis","Meningitis","UTI"], ans:1, exp:"تُسبب SBE خاصة مع صمامات متأذية. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"Enterococcus is differentiated by:", opts:["Growth in 6.5% NaCl","Coagulase test","Bacitracin test","CAMP test"], ans:0, exp:"ينمو في 6.5% NaCl. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"Neisseria are:", opts:["Gram-negative diplococci","Gram-positive diplococci","Gram-negative bacilli","Gram-positive bacilli"], ans:0, exp:"دبلوكوكس سالب الجرام. المصدر: Lecture 5 – Neisseria.", ref:"Neisseria lecture"},
  {q:"N. gonorrhoeae ferments:", opts:["Glucose only","Glucose & maltose","Maltose only","Lactose"], ans:0, exp:"تخمر الجلوكوز فقط. المصدر: Lecture 5.", ref:"Neisseria lecture"},
  {q:"N. meningitidis ferments:", opts:["Glucose only","Glucose & maltose","Lactose","None"], ans:1, exp:"تخمر الجلوكوز والمالتوز. المصدر: Lecture 5.", ref:"Neisseria lecture"},
  {q:"Selective medium for Neisseria:", opts:["Blood agar","Thayer-Martin agar","Nutrient agar","Chocolate agar"], ans:1, exp:"MTM/Thayer–Martin (Chocolate + مضادات). المصدر: Lecture 5.", ref:"Neisseria lecture"},
  {q:"Virulence factor of N. gonorrhoeae:", opts:["Pili","Endospore","Capsule","Flagella"], ans:0, exp:"الأهداب للالتصاق، الخلايا المُهدبة هي الأشد إمراضًا. المصدر: Lecture 5.", ref:"Neisseria lecture"},
  {q:"Disease caused by N. gonorrhoeae:", opts:["Gonorrhea","Meningitis","Pneumonia","UTI"], ans:0, exp:"السيلان. المصدر: Lecture 5.", ref:"Neisseria lecture"},
  {q:"Capsule swelling test for N. meningitidis:", opts:["Quellung reaction","CAMP test","ASO test","Oxidase test"], ans:0, exp:"Quellung للتعرف على الكبسولة. المصدر: Lecture 5.", ref:"Neisseria lecture"},
  {q:"Main reservoir of N. meningitidis:", opts:["Nasopharynx carriers","Animals","Soil","Water"], ans:0, exp:"حَمَلة البلعوم الأنفي. المصدر: Lecture 5.", ref:"Neisseria lecture"},
  {q:"Treatment of gonorrhea:", opts:["Ceftriaxone","Penicillin always","Vancomycin","Rifampicin"], ans:0, exp:"الخطة الأشيع المذكورة بالمحاضرة: سيفترياكسون. المصدر: Lecture 5.", ref:"Neisseria lecture"},
  {q:"Prevention of meningococcal disease:", opts:["Multivalent polysaccharide vaccine","Toxoid vaccine","ASO vaccine","No vaccine"], ans:0, exp:"لقاحات متعددة التكافؤ: A, C, Y, W135. المصدر: Lecture 5.", ref:"Neisseria lecture"},
  {q:"Normal flora absent in:", opts:["Stool","Throat","Urine","Mouth"], ans:2, exp:"البول الطبيعي معقم. المصدر: Lecture 1.", ref:"Introduction lecture"},
  {q:"Commensals are organisms that:", opts:["Benefit without harming host","Always cause disease","Require immune defect","Obligate pathogens"], ans:0, exp:"عيش تكافلي لصالحها دون ضرر للمضيف. المصدر: Lecture 1/2.", ref:"Intro / Host–Parasite"},
  {q:"Pandemic disease is:", opts:["Worldwide","Sporadic","Local","Seasonal"], ans:0, exp:"انتشار عالمي. المصدر: Lecture 2.", ref:"Host–Parasite lecture"},
  {q:"Epidemic means:", opts:["Sudden increase in cases","Constant presence","Worldwide","Sporadic"], ans:0, exp:"وباء = ارتفاع مفاجئ. المصدر: Lecture 2.", ref:"Host–Parasite lecture"},
  {q:"Gram stain of Neisseria shows:", opts:["Gram-negative diplococci","Gram-positive chains","Gram-positive clusters","Gram-negative rods"], ans:0, exp:"دبلوكوكس سالب الجرام، غالبًا داخل الخلايا. المصدر: Lecture 5.", ref:"Neisseria lecture"},
  {q:"Oxidase test for Neisseria:", opts:["Positive","Negative","Variable","None"], ans:0, exp:"نييسرية مؤكسدة موجبة. المصدر: Lecture 5.", ref:"Neisseria lecture"},
  {q:"S. pneumoniae morphology is:", opts:["Gram-positive diplococci","Gram-negative diplococci","Gram-positive chains","Gram-negative bacilli"], ans:0, exp:"دبلو-كوكس موجب الجرام شبيه الحَبّة. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"Enterococcus faecalis grows in presence of:", opts:["6.5% NaCl","1% bile","Oxygen only","Novobiocin"], ans:0, exp:"اختبار تحمل الملح. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"Staphylococcus is catalase:", opts:["Positive","Negative","Variable","None"], ans:0, exp:"ستاف موجبة الكاتالاز. المصدر: Lecture 3.", ref:"Staphylococci lecture"},
  {q:"Streptococcus is catalase:", opts:["Negative","Positive","Variable","None"], ans:0, exp:"ستربتو سالبة الكاتالاز. المصدر: Lecture 4.", ref:"Streptococci lecture"},
  {q:"Staphylococcal toxin causing scalded skin syndrome:", opts:["Exfoliative toxin","Enterotoxin","Endotoxin","Hemolysin"], ans:0, exp:"السم المقشِّر يسبب SSSS. المصدر: Lecture 3.", ref:"Staphylococci lecture"},
  {q:"Primary site of N. gonorrhoeae infection in females:", opts:["Cervix","Ovary","Uterus","Fallopian tube"], ans:0, exp:"الموقع الأكثر شيوعًا: عنق الرحم (cervicitis). المصدر: Lecture 5.", ref:"Neisseria lecture"}
];

// Render
const container = document.getElementById('container');
function render(list=QUESTIONS){
  container.innerHTML = '';
  list.forEach((item, idx)=>{
    const card = document.createElement('div'); card.className='card'; card.dataset.index=idx;
    const head = document.createElement('div'); head.className='q-head';
    head.innerHTML = `<div><span class="qid">Q${idx+1}.</span> <span class="qtext">${item.q}</span></div>`;
    const opts = document.createElement('div'); opts.className='opts';
    item.opts.forEach((op,i)=>{
      const id = `q${idx}_o${i}`;
      const row = document.createElement('label'); row.className='opt'; row.htmlFor=id;
      row.innerHTML = `<input type="radio" name="q${idx}" id="${id}" value="${i}"> <span><b>${String.fromCharCode(65+i)}.</b> ${op}</span>`;
      opts.appendChild(row);
    });
    const exp = document.createElement('div'); exp.className='exp'; exp.id=`exp${idx}`;
    exp.innerHTML = `<div><span class="badge good">Explanation (AR)</span></div>${item.exp}<div class="ref">Source: ${item.ref}</div>`;
    card.appendChild(head); card.appendChild(opts); card.appendChild(exp);
    container.appendChild(card);
  });
}
render();

// Submit & grade
const scoreBox = document.getElementById('score');
const note = document.getElementById('note');

function grade(showExplanations=true){
  let correct = 0;
  QUESTIONS.forEach((item, idx)=>{
    const chosen = document.querySelector(`input[name="q${idx}"]:checked`);
    const exp = document.getElementById(`exp${idx}`);
    const card = document.querySelector(`.card[data-index="${idx}"]`);
    card.classList.remove('correct','wrong');
    if(!chosen){
      exp.classList.add('show');
      exp.innerHTML = `<div><span class="badge bad">Unanswered</span></div>${item.exp}<div class="ref">Source: ${item.ref}</div>`;
      continue;
    }
    const val = parseInt(chosen.value,10);
    if(val===item.ans){
      correct++;
      card.classList.add('correct');
      if(showExplanations){
        exp.classList.add('show');
        exp.innerHTML = `<div><span class="badge good">Correct</span></div>${item.exp}<div class="ref">Source: ${item.ref}</div>`;
      }
    }else{
      card.classList.add('wrong');
      exp.classList.add('show');
      const correctLetter = String.fromCharCode(65+item.ans);
      exp.innerHTML = `<div><span class="badge bad">Incorrect</span></div><div><b>Correct answer: ${correctLetter}. ${item.opts[item.ans]}</b></div><div style="margin-top:6px">${item.exp}</div><div class="ref">Source: ${item.ref}</div>`;
    }
  });
  scoreBox.textContent = `${correct} / ${QUESTIONS.length}`;
  note.textContent = `Submitted at ${new Date().toLocaleString()}`;
  window.scrollTo({top:0, behavior:'smooth'});
}

document.getElementById('submitBtn').addEventListener('click', ()=> grade(true));

// Reveal correct answers without changing selections
document.getElementById('showAnswersBtn').addEventListener('click', ()=>{
  QUESTIONS.forEach((item, idx)=>{
    const exp = document.getElementById(`exp${idx}`);
    exp.classList.add('show');
    const correctLetter = String.fromCharCode(65+item.ans);
    exp.innerHTML = `<div><span class="badge good">Answer</span></div><div><b>${correctLetter}. ${item.opts[item.ans]}</b></div><div style="margin-top:6px">${item.exp}</div><div class="ref">Source: ${item.ref}</div>`;
  });
  note.textContent = 'Answers revealed (not graded)';
});

// Reset
document.getElementById('resetBtn').addEventListener('click', ()=>{
  document.querySelectorAll('input[type="radio"]').forEach(i=> i.checked=false);
  document.querySelectorAll('.exp').forEach(e=>{e.classList.remove('show'); e.innerHTML='';});
  document.querySelectorAll('.card').forEach(c=> c.classList.remove('correct','wrong'));
  scoreBox.textContent = `0 / ${QUESTIONS.length}`;
  note.textContent = 'Not submitted';
  window.scrollTo({top:0, behavior:'smooth'});
});

// Filter/search
const search = document.getElementById('search');
search.addEventListener('input', (e)=>{
  const term = e.target.value.trim().toLowerCase();
  if(!term){ render(); return;}
  const filtered = QUESTIONS.filter(x => (x.q + ' ' + x.opts.join(' ')+ ' ' + x.ref).toLowerCase().includes(term));
  render(filtered);
  note.textContent = `Filter: ${filtered.length} shown of ${QUESTIONS.length}`;
});

// Export results
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const results = QUESTIONS.map((item, idx)=>{
    const chosen = document.querySelector(`input[name="q${idx}"]:checked`);
    const ansLetter = String.fromCharCode(65+item.ans);
    return {
      id: idx+1,
      question: item.q,
      options: item.opts,
      correct: {index:item.ans, letter:ansLetter, text:item.opts[item.ans]},
      chosen: chosen? {index:+chosen.value, letter:String.fromCharCode(65+ +chosen.value), text:item.opts[+chosen.value]} : null,
      ref: item.ref
    };
  });
  const blob = new Blob([JSON.stringify({timestamp: new Date().toISOString(), total: QUESTIONS.length, results}, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'microbiology_exam_results.json';
  a.click();
  URL.revokeObjectURL(url);
});
</script>
</body>
</html>
